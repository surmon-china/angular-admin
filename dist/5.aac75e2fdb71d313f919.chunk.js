webpackJsonp([5],{1217:function(module,exports,__webpack_require__){"use strict";var core_1=__webpack_require__(0),common_1=__webpack_require__(14),forms_1=__webpack_require__(12),nga_module_1=__webpack_require__(300),ng2_bootstrap_1=__webpack_require__(299),comment_routing_1=__webpack_require__(1414),comment_service_1=__webpack_require__(1236),comment_component_1=__webpack_require__(1259),list_1=__webpack_require__(1262),detail_1=__webpack_require__(1261),CommentModule=function(){function CommentModule(){}return CommentModule=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,forms_1.ReactiveFormsModule,nga_module_1.NgaModule,ng2_bootstrap_1.PaginationModule,ng2_bootstrap_1.DropdownModule,ng2_bootstrap_1.ModalModule,comment_routing_1.routing],providers:[comment_service_1.CommentService],declarations:[comment_component_1.Comment,list_1.CommentList,detail_1.CommentDetail]}),__metadata("design:paramtypes",[])],CommentModule)}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CommentModule},1236:function(module,exports,__webpack_require__){"use strict";var core_1=__webpack_require__(0),http_1=__webpack_require__(125),angular2_jwt_1=__webpack_require__(180),angular2_notifications_1=__webpack_require__(124);__webpack_require__(587);var config_1=__webpack_require__(301),CommentService=function(){function CommentService(http,_notificationsService){var _this=this;this.http=http,this._notificationsService=_notificationsService,this._apiUrl=config_1.API_ROOT+"/comment",this.handleResponse=function(response){var data=response.json();return data.code?(_this._notificationsService.success(data.message,"数据请求成功"),Promise.resolve(data)):(_this._notificationsService.error(data.message,data.debug?data.debug.message:data.message),Promise.reject(data))},this.handleError=function(error){var errmsg=[500,504].indexOf(error.status)>-1?error._body:JSON.parse(error._body).message;return _this._notificationsService.error("请求失败",errmsg),Promise.reject(error)}}return CommentService.prototype.getComments=function(get_params){var params=new http_1.URLSearchParams;return get_params&&Object.keys(get_params).forEach(function(k){params.set(k,get_params[k])}),this.http.get(this._apiUrl,{search:params}).toPromise().then(this.handleResponse).catch(this.handleError)},CommentService.prototype.unique=function(arr,newArr){var num;-1==arr.indexOf(num=arr.shift())&&newArr.push(num),arr.length&&this.unique(arr,newArr)},CommentService.prototype.updateCommentState=function(comments,post_ids,state){var _post_ids=[];return this.unique(post_ids,_post_ids),post_ids=_post_ids,this.http.patch(this._apiUrl,{comments:comments,post_ids:post_ids,state:state}).toPromise().then(this.handleResponse).catch(this.handleError)},CommentService.prototype.delComments=function(comments,post_ids){var _post_ids=[];return this.unique(post_ids,_post_ids),post_ids=_post_ids,this.http.delete(this._apiUrl,new http_1.RequestOptions({body:{comments:comments,post_ids:post_ids}})).toPromise().then(this.handleResponse).catch(this.handleError)},CommentService.prototype.getCommentDetail=function(comment_id){return this.http.get(this._apiUrl+"/"+comment_id).toPromise().then(this.handleResponse).catch(this.handleError)},CommentService.prototype.updateCommentDetail=function(comment){return this.http.put(this._apiUrl+"/"+comment._id,comment).toPromise().then(this.handleResponse).catch(this.handleError)},CommentService.prototype.getCommentArticleDetail=function(post_id){return this.http.get(config_1.API_ROOT+"/article/"+post_id).toPromise().then(this.handleResponse).catch(this.handleError)},CommentService=__decorate([core_1.Injectable(),__metadata("design:paramtypes",["function"==typeof(_a="undefined"!=typeof angular2_jwt_1.AuthHttp&&angular2_jwt_1.AuthHttp)&&_a||Object,"function"==typeof(_b="undefined"!=typeof angular2_notifications_1.NotificationsService&&angular2_notifications_1.NotificationsService)&&_b||Object])],CommentService);var _a,_b}();exports.CommentService=CommentService},1259:function(module,exports,__webpack_require__){"use strict";var core_1=__webpack_require__(0),Comment=function(){function Comment(){}return Comment=__decorate([core_1.Component({selector:"comment",template:"<router-outlet></router-outlet>"}),__metadata("design:paramtypes",[])],Comment)}();exports.Comment=Comment},1260:function(module,exports){"use strict";exports.UAParse=function(e){var r=new Array,outputer="";if(r=e.match(/MSIE\s([^\s|]+)/gi))outputer='<span class="ua_ie"><i class="iconfont icon-internet"></i>Internet Explorer | '+r[0].replace("MSIE","").split(".")[0];else if(r=e.match(/FireFox\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_firefox"><i class="iconfont icon-internet"></i>Mozilla FireFox | '+r1[1]}else if(r=e.match(/Maxthon([\d]*)\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_maxthon"><i class="iconfont icon-internet"></i>Maxthon'}else if(r=e.match(/UBrowser([\d]*)\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_ucweb"><i class="iconfont icon-internet"></i>UCBrowser | '+r1[1]}else if(r=e.match(/MetaSr/gi))outputer='<span class="ua_sogou"><i class="iconfont icon-internet"></i>搜狗浏览器';else if(r=e.match(/2345Explorer/gi))outputer='<span class="ua_2345explorer"><i class="iconfont icon-internet"></i>2345王牌浏览器';else if(r=e.match(/2345chrome/gi))outputer='<span class="ua_2345chrome"><i class="iconfont icon-internet"></i>2345加速浏览器';else if(r=e.match(/LBBROWSER/gi))outputer='<span class="ua_lbbrowser"><i class="iconfont icon-internet"></i>猎豹安全浏览器';else if(r=e.match(/MicroMessenger\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_qq"><i class="iconfont icon-weichat"></i>微信 | '+r1[1].split("/")[0]}else if(r=e.match(/QQBrowser\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_qq"><i class="iconfont icon-internet"></i>QQ浏览器 | '+r1[1].split("/")[0]}else if(r=e.match(/QQ\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_qq"><i class="iconfont icon-internet"></i>QQ浏览器 | '+r1[1].split("/")[0]}else if(r=e.match(/MiuiBrowser\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_mi"><i class="iconfont icon-internet"></i>Miui浏览器 | '+r1[1].split("/")[0]}else if(r=e.match(/Chrome([\d]*)\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_chrome"><i class="iconfont icon-internet"></i>Chrome | '+r1[1].split(".")[0]}else if(r=e.match(/safari\/([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_apple"><i class="iconfont icon-internet"></i>Apple Safari | '+r1[1]}else if(r=e.match(/Opera[\s|\/]([^\s]+)/gi)){var r1=r[0].split("/");outputer='<span class="ua_opera"><i class="iconfont icon-internet"></i>Opera | '+r[1]}else outputer=(r=e.match(/Trident\/7.0/gi))?'<span class="ua_ie"><i class="iconfont icon-internet"></i>Internet Explorer 11':'<span class="ua_other"><i class="iconfont icon-internet"></i>其它浏览器';return outputer+"</span>"},exports.OSParse=function(e){var os="";return os=e.match(/win/gi)?e.match(/nt 5.1/gi)?'<span class="os_xp"><i class="iconfont icon-windows"></i>Windows XP':e.match(/nt 6.1/gi)?'<span class="os_7"><i class="iconfont icon-windows"></i>Windows 7':e.match(/nt 6.2/gi)?'<span class="os_8"><i class="iconfont icon-windows"></i>Windows 8':e.match(/nt 6.3/gi)?'<span class="os_8_1"><i class="iconfont icon-windows"></i>Windows 8.1':e.match(/nt 10.0/gi)?'<span class="os_8_1"><i class="iconfont icon-windows"></i>Windows 10':e.match(/nt 6.0/gi)?'<span class="os_vista"><i class="iconfont icon-windows"></i>Windows Vista':e.match(/nt 5/gi)?'<span class="os_2000"><i class="iconfont icon-windows"></i>Windows 2000':'<span class="os_windows"><i class="iconfont icon-windows"></i>Windows':e.match(/android/gi)?'<span class="os_android"><i class="iconfont icon-android"></i>Android':e.match(/ubuntu/gi)?'<span class="os_ubuntu">Ubuntu':e.match(/linux/gi)?'<span class="os_linux"><i class="iconfont icon-linux"></i>Linux':e.match(/mac/gi)?'<span class="os_mac"><i class="iconfont icon-mac"></i>Mac OS X':e.match(/unix/gi)?'<span class="os_unix"><i class="iconfont icon-unix"></i>Unix':'<span class="os_other"><i class="iconfont icon-phone"></i>Other',os+"</span>"}},1261:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1415))},1262:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1416))},1326:function(module,exports){module.exports=".comment-form .form-control.comemnt-content {\n  padding: 0; }\n\n.comment-form .comment-extend {\n  overflow: hidden;\n  margin-bottom: 1em; }\n  .comment-form .comment-extend .extend-key,\n  .comment-form .comment-extend .extend-value {\n    float: left;\n    width: 41%;\n    margin-right: 3%; }\n  .comment-form .comment-extend .extend-del {\n    float: right; }\n"},1327:function(module,exports){module.exports=".comment-list .batch-checkbox {\n  text-align: left;\n  padding-left: 2em; }\n\n.comment-list .comment-err-msg {\n  margin: 1em 0; }\n\n.comment-list tbody tr.comment-item {\n  height: 13em; }\n\n.comment-list tbody tr td.comment-content {\n  line-height: 2;\n  word-break: break-word; }\n"},1352:function(module,exports){module.exports='<div class="row">\n  <div class="col-md-12">\n    <ba-card title="评论详情" baCardClass="with-scroll">\n      <form class="comment-form form-horizontal"\n            [formGroup]="editForm" \n            (ngSubmit)="submitComment(editForm.value)">\n        <div class="form-group row">\n          <label class="col-sm-1 form-control-label text-right">ID</label>\n          <div class="col-sm-2">\n            <div class="form-control">{{ comment.id }}</div>\n          </div>\n        </div>\n        <div class="form-group row">\n          <label class="col-sm-1 form-control-label text-right">所在文章</label>\n          <div class="col-sm-2">\n            <div class="form-control">\n              <span *ngIf="comment.post_id != 0">{{ article ? article.title : \'未知文章\' }}</span>\n              <span *ngIf="comment.post_id == 0">留言板</span>\n            </div>\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!likes.valid && likes.touched), \n                \'has-success\': (likes.valid && likes.touched)\n              }">\n          <label for="comment_likes" class="col-sm-1 form-control-label text-right">喜欢人数</label>\n          <div class="col-sm-2">\n            <input type="number" \n                   id="comment_likes" \n                   class="form-control" \n                   placeholder="喜欢人数" \n                   [formControl]="likes">\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!is_top.valid && is_top.touched), \n                \'has-success\': (is_top.valid && is_top.touched)\n              }">\n          <label for="comment_is_top" class="col-sm-1 form-control-label text-right">是否置顶</label>\n          <div class="col-sm-2">\n            <select class="form-control c-select" id="comment_is_top" [formControl]="is_top">\n              <option [value]="false">不置顶</option>\n              <option [value]="true">置顶</option>\n            </select>\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!state.valid && state.touched), \n                \'has-success\': (state.valid && state.touched)\n              }">\n          <label for="comment_state" class="col-sm-1 form-control-label text-right">状态</label>\n          <div class="col-sm-2">\n            <select class="form-control c-select" id="comment_state" [formControl]="state">\n              <option [value]="-2">垃圾评论</option>\n              <option [value]="-1">已删除</option>\n              <option [value]="0">待审核</option>\n              <option [value]="1">审核通过</option>\n            </select>\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!user_name.valid && user_name.touched), \n                \'has-success\': (user_name.valid && user_name.touched)\n              }">\n          <label for="comment_user_name" class="col-sm-1 form-control-label text-right">用户名</label>\n          <div class="col-sm-2">\n            <input type="text" \n                   id="comment_user_name" \n                   class="form-control" \n                   placeholder="用户名" \n                   [formControl]="user_name">\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!user_email.valid && user_email.touched), \n                \'has-success\': (user_email.valid && user_email.touched)\n              }">\n          <label for="comment_user_email" class="col-sm-1 form-control-label text-right">用户邮箱</label>\n          <div class="col-sm-2">\n            <input type="email" \n                   id="comment_user_email" \n                   class="form-control" \n                   placeholder="用户邮箱" \n                   [formControl]="user_email">\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!user_site.valid && user_site.touched), \n                \'has-success\': (user_site.valid && user_site.touched)\n              }">\n          <label for="comment_user_site" class="col-sm-1 form-control-label text-right">用户地址</label>\n          <div class="col-sm-2">\n            <input type="url" \n                   id="comment_user_site" \n                   class="form-control" \n                   placeholder="用户的个人网址" \n                   [formControl]="user_site">\n          </div>\n        </div>\n        <div class="form-group row">\n          <label class="col-sm-1 form-control-label text-right">创建时间</label>\n          <div class="col-sm-2">\n            <div class="form-control">{{ comment.create_at | dataToLocale }}</div>\n          </div>\n        </div>\n        <div  class="form-group row">\n          <label class="col-sm-1 form-control-label text-right">客户端信息</label>\n          <div class="col-sm-5">\n            <div class="form-control">\n              <span *ngIf="comment.ip">{{ comment.ip }}</span>\n              <span *ngIf="!comment.ip" class="text-muted">未知ip</span>\n            </div>\n            <br>\n            <div class="form-control">\n              <span *ngIf="comment.ip_location">{{ comment.ip_location.country }}{{ comment.ip_location.city }}</span>\n              <span *ngIf="!comment.ip_location" class="text-muted">未知物理地址</span>\n            </div>\n            <br>\n            <div class="form-control">\n              <span>操作系统：</span>\n              <span *ngIf="comment.agent" [innerHTML]="OSParse(comment.agent)"></span>\n              <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>\n              <span>浏览器：</span>\n              <span *ngIf="comment.agent" [innerHTML]="UAParse(comment.agent)"></span>\n              <span *ngIf="!comment.agent" class="text-muted">未知地址</span>\n            </div>\n          </div>\n        </div>\n        <div class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!pid.valid && pid.touched), \n                \'has-success\': (pid.valid && pid.touched)\n              }">\n          <label for="PID" class="col-sm-1 form-control-label text-right">父级评论</label>\n          <div class="col-sm-5">\n            <select class="form-control c-select" [formControl]="pid">\n              <option default value="0">无父级评论</option>\n              <template [ngIf]="comment.id && comments && comments.data.length">\n                <option *ngFor="let item of comments.data" \n                        [ngValue]="item.id"\n                        [disabled]="item.id == comment.id">\n                  <span>ID：{{ item.id }}  -  {{ item.author.name }}：{{ item.content | truncate : 160 }}</span>\n                </option>\n              </template>\n            </select>\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!content.valid && content.touched), \n                \'has-success\': (content.valid && content.touched)\n              }">\n          <label for="comment_content" class="col-sm-1 form-control-label text-right">内容</label>\n          <div class="col-sm-5">\n            <markdown-editor  class="form-control comemnt-content" \n                              title="评论内容"\n                              id="comment_content"\n                              [formControl]="content">\n            </markdown-editor>\n          </div>\n        </div>\n        <div  class="form-group row"\n              [ngClass]="{ \n                \'has-error\': (!extends.valid && extends.touched), \n                \'has-success\': (extends.valid && extends.touched)\n              }">\n          <label for="comment_extends" class="col-sm-1 form-control-label text-right">自定义扩展</label>\n          <div class="col-sm-5">\n            <div class="comment-extend" *ngFor="let extend of extends.value; let i = index">\n              <div class="extend-key">\n                <input type="text" \n                       id="comment_name"\n                       class="form-control"\n                       placeholder="key" \n                       [(ngModel)]="extend.name"\n                       [ngModelOptions]="{ standalone: true }">\n              </div>\n              <div class="extend-value">\n                <input type="text" \n                       id="comment_name"\n                       class="form-control"\n                       placeholder="value" \n                       [(ngModel)]="extend.value"\n                       [ngModelOptions]="{ standalone: true }">\n              </div>\n              <div class="extend-del">\n                <button class="btn btn-warning" (click)="delExtendItem(i)">\n                  <i class="ion-trash-b"></i>\n                </button>\n              </div>\n            </div>\n            <a [href]="" class="btn btn-default btn-sm btn-block" (click)="addExtendItem()">增加扩展</a>\n            <span class="help-block sub-little-text">可以为当前评论扩展自定义扩展属性</span>\n          </div>\n        </div>\n        <hr>\n        <div class="row">\n          <div class="col-sm-1"></div>\n          <div class="col-sm-11">\n            <button type="submit" class="btn btn-success"\n                    [disabled]="!editForm.valid">提交更改</button>\n            <span>&nbsp;</span>\n            <a [href]="" class="btn btn-info" (click)="getCommentDetail()">刷新评论</a>\n            <span>&nbsp;</span>\n            <a class="btn btn-default"\n               [routerLink]="[\'/comment/post/\', comment.post_id]">回到宿主页面评论列表</a>\n          </div>\n        </div>\n      </form>\n    </ba-card>\n  </div>\n</div>\n'},1353:function(module,exports){module.exports='<div class="row">\n  <div class="col-lg-12 col-md-12">\n    <ba-card title="评论列表" baCardClass="with-scroll table-panel">\n      <div class="contnet-top-tools">\n        <div class="pull-left">\n          <div class="btn-group">\n            <button class="btn btn-success" *ngIf="post_id == 0">\n              <strong>留言板评论列表</strong>\n            </button>\n            <button class="btn btn-info" *ngIf="!!post_id && post_id != 0">\n              <strong>文章 {{ post_id }} 评论列表</strong>\n            </button>\n            <button type="button"\n                    class="btn btn-default active"\n                    [ngClass]="{ \'active\': getParams.state == \'all\'}"\n                    (click)="switchState(\'all\')">\n              <span>全部</span>\n              <span *ngIf="getParams.state == \'all\'">({{ comments.pagination.total || 0 }})</span>\n            </button>\n            <button type="button"\n                    class="btn btn-default"\n                    [ngClass]="{ \'active\': getParams.state == 1 }"\n                    (click)="switchState(1)">\n              <span>已发布</span>\n              <span *ngIf="getParams.state == 1">({{ comments.pagination.total || 0 }})</span>\n            </button>\n            <button type="button"\n                    class="btn btn-default"\n                    [ngClass]="{ \'active\': getParams.state == 0 }"\n                    (click)="switchState(0)">\n              <span>待审核</span>\n              <span *ngIf="getParams.state == 0">({{ comments.pagination.total || 0 }})</span>\n            </button>\n            <button type="button"\n                    class="btn btn-default"\n                    [ngClass]="{ \'active\': getParams.state == -1 }"\n                    (click)="switchState(-1)">\n              <span>回收站</span>\n              <span *ngIf="getParams.state == -1">({{ comments.pagination.total || 0 }})</span>\n            </button>\n            <button type="button"\n                    class="btn btn-default"\n                    [ngClass]="{ \'active\': getParams.state == -2 }"\n                    (click)="switchState(-2)">\n              <span>垃圾评论</span>\n              <span *ngIf="getParams.state == -2">({{ comments.pagination.total || 0 }})</span>\n            </button>\n          </div>\n          <span>&nbsp;</span>\n          <div class="btn-group">\n            <button type="button" \n                    class="btn btn-default btn-with-icon"\n                    (click)="refreshComments()">\n              <i class="ion-refresh"></i>\n              <span>刷新</span>\n            </button>\n            <button type="button" \n                    class="btn btn-default btn-with-icon"\n                    (click)="resetGetParams()">\n              <i class="ion-trash-b"></i>\n              <span>清空搜索条件</span>\n            </button>\n            <div class="btn-group" dropdown>\n              <button type="button" \n                      class="btn btn-default"\n                      addToggleClass="true"\n                      dropdownToggle\n                      [disabled]="!selectedComments.length">\n                <i class="ion-ios-list"></i>\n                <span>批量操作</span>\n              </button>\n              <ul class="dropdown-menu" dropdownMenu>\n                <li class="dropdown-item">\n                  <a [href]="" (click)="updateCommentState(selectedComments, selectedPostIds, 1)">审核通过</a>\n                </li>\n                <li class="dropdown-item">\n                  <a [href]="" (click)="updateCommentState(selectedComments, selectedPostIds, 0)">移至待审核</a>\n                </li>\n                <li class="dropdown-item">\n                  <a [href]="" (click)="updateCommentState(selectedComments, selectedPostIds, -1)">移至回收站</a>\n                </li>\n                <li class="dropdown-item">\n                  <a [href]="" (click)="updateCommentState(selectedComments, selectedPostIds, -2)">标为垃圾评论</a>\n                </li>\n                <li class="dropdown-item">\n                  <a [href]="" (click)="delCommentModal(selectedComments)">彻底删除</a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n        <form class="pull-right form-inline comment-get-form"\n              [formGroup]="searchForm" \n              (ngSubmit)="searchComments(searchForm.value)">\n          <div class="input-group">\n            <input type="text"\n                   [formControl]="keyword" \n                   class="form-control with-default-addon" \n                   placeholder="评论内容、作者信息">\n            <span class="input-group-btn">\n              <button class="btn btn-default" \n                      type="submit"\n                      [disabled]="!searchForm.valid">搜索</button>\n            </span>\n          </div>\n        </form>\n        <span class="pull-right">&nbsp;&nbsp;&nbsp;</span>\n        <div class="pull-right form-inline">\n          <select class="form-control c-select" \n                  [(ngModel)]="getParams.sort"\n                  (ngModelChange)="getComments()">\n            <option value="-1" default>最新评论</option>\n            <option value="1">最早评论</option>\n            <option value="2">最热评论</option>\n          </select>\n        </div>\n      </div>\n      <div class="table-responsive">\n        <div class="comment-list">\n          <table class="table tablehover table-striped table-no-borders black-muted-bg table-enrich">\n            <thead class="thead-inverse">\n              <tr>\n                <th>\n                  <ba-checkbox [(ngModel)]="commentsSelectAll" (ngModelChange)="batchSelectChange($event)">\n                    <span ba-checkbox-label>\n                      <span>&nbsp;</span>\n                      <strong>ID</strong>\n                    </span>\n                  </ba-checkbox>\n                </th>\n                <th>PID</th>\n                <th>POST</th>\n                <th width="23%">评论内容</th>\n                <th>个人信息</th>\n                <th>终端</th>\n                <th>点赞</th>\n                <th>置顶</th>\n                <th>日期</th>\n                <th>状态</th>\n                <th>操作</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr *ngIf="!comments || !comments.data.length">\n                <td colspan="11">\n                  <p class="text-muted text-center comment-err-msg" *ngIf="!comments.data.length">暂无数据<p>\n                </td>\n              </tr>\n              <template [ngIf]="comments && comments.data.length">\n                <tr *ngFor="let comment of comments.data" class="comment-item">\n                  <td class="batch-checkbox">\n                    <ba-checkbox [(ngModel)]="comment.selected" (ngModelChange)="itemSelectChange()">\n                      <span ba-checkbox-label>\n                        <span>&nbsp;</span>\n                        <strong>{{ comment.id }}</strong>\n                      </span>\n                    </ba-checkbox>\n                  </td>\n                  <td>\n                    <a *ngIf="!!comment.pid"\n                       [routerLink]="[\'/comment/detail/\', comment.pid]">{{ comment.pid }}</a>\n                    <span *ngIf="!comment.pid">{{ comment.pid }}</span>\n                  </td>\n                  <td>\n                    <a [routerLink]="[\'/comment/post/\', comment.post_id]">{{ comment.post_id }}</a>\n                  </td>\n                  <td class="comment-content">\n                    <span class="content">\n                      <span *ngIf="comment.content">{{ comment.content | truncate : 160 }}</span>\n                      <span *ngIf="!comment.content" class="text-muted">暂无内容</span>\n                    </span>\n                  </td>\n                  <td class="comment-user">\n                    <div><strong>名字：</strong>{{ comment.author.name }}</div>\n                    <div>\n                      <strong>邮箱：</strong>\n                      <a [href]="\'mailto:\' + comment.author.email" target="_blank">{{ comment.author.email }}</a>\n                    </div>\n                    <div>\n                      <strong>网址：</strong>\n                      <a [href]="comment.author.site" target="_blank">{{ comment.author.site || \'无\' }}</a>\n                    </div>\n                  </td>\n                  <td class="comment-tag">\n                    <div>\n                      <strong>IP：</strong>\n                      <span *ngIf="!!comment.ip">{{ comment.ip }}</span>\n                      <span *ngIf="!comment.ip" class="text-muted">未知</span>\n                    </div>\n                    <div>\n                      <strong>地理位置：</strong>\n                      <span *ngIf="comment.ip_location">{{ comment.ip_location.country + comment.ip_location.city }}</span>\n                      <span *ngIf="!comment.ip_location" class="text-muted">未知</span>\n                    </div>\n                    <div>\n                      <strong>浏览器：</strong>\n                      <span [innerHTML]="UAParse(comment.agent)"></span>\n                    </div>\n                    <div>\n                      <strong>系统：</strong>\n                      <span [innerHTML]="OSParse(comment.agent)"></span>\n                    </div>\n                  </td>\n                  <td>\n                    <span>{{ comment.likes }}</span>\n                  </td>\n                  <td>{{ comment.is_top ? \'是\' : \'否\' }}</td>\n                  <td>{{ comment.create_at | dataToLocale }}</td>\n                  <td>\n                    <i class="ion-checkmark text-success" *ngIf="comment.state == 1"></i>\n                    <i class="ion-edit text-warning" *ngIf="comment.state == 0"></i>\n                    <i class="ion-trash-b text-danger" *ngIf="comment.state == -1"></i>\n                    <i class="ion-nuclear text-danger" *ngIf="comment.state == -2"></i>\n                    <span [ngSwitch]="comment.state">\n                      <span *ngSwitchCase="0">待审核</span>\n                      <span *ngSwitchCase="1">审核通过</span>\n                    </span>\n                    <span *ngIf="comment.state == -1">已删除</span>\n                    <span *ngIf="comment.state == -2">垃圾评论</span>\n                  </td>\n                  <td>\n                    <div class="button-wrapper">\n                      <a class="btn btn-success btn-sm" [routerLink]="[\'/comment/detail/\', comment._id]">评论详情</a>\n                    </div>\n                    <div class="button-wrapper" *ngIf="comment.state == 0">\n                      <button class="btn btn-warning btn-sm" \n                              (click)="updateCommentState([comment._id], [comment.post_id], 1)">审核通过</button>\n                    </div>\n                    <div class="button-wrapper" *ngIf="comment.state < 0">\n                      <button class="btn btn-warning btn-sm" \n                              (click)="updateCommentState([comment._id], [comment.post_id], 0)">恢复评论</button>\n                    </div>\n                    <div class="button-wrapper" *ngIf="comment.state == 1">\n                      <button class="btn btn-danger btn-sm" \n                              (click)="updateCommentState([comment._id], [comment.post_id], -2)">标为垃圾</button>\n                    </div>\n                    <div class="button-wrapper" *ngIf="comment.state != -1">\n                      <button class="btn btn-danger btn-sm" \n                              (click)="updateCommentState([comment._id], [comment.post_id], -1)">移回收站</button>\n                    </div>\n                    <div class="button-wrapper" *ngIf="comment.state == -1">\n                      <button class="btn btn-danger btn-sm" \n                              (click)="delCommentModal([comment._id])">彻底删除</button>\n                    </div>\n                     <div class="button-wrapper">\n                      <a class="btn btn-info btn-sm" [routerLink]="[\'/comment/post/\', comment.post_id]">宿主页面</a>\n                    </div>\n                  </td>\n                </tr>\n              </template>\n            </tbody>\n          </table>\n           <br>\n          <div class="text-center">\n            <pagination class="pagination-xs"\n                        firstText="首页"\n                        lastText="末页"\n                        nextText="下一页"\n                        previousText="上一页"\n                        pageBtnClass="btn-primary"\n                        [totalItems]="comments.pagination.total"\n                        [itemsPerPage]="comments.pagination.per_page"\n                        [(ngModel)]="comments.pagination.current_page"\n                        [maxSize]="7"\n                        [boundaryLinks]="true"\n                        [rotate]="false"\n                        (pageChanged)="pageChanged($event)">\n            </pagination>\n          </div>\n        </div>\n      </div>\n    </ba-card>\n    <!-- 删除确认弹窗 -->\n    <div bsModal #delModal="bs-modal" class="modal fade" tabindex="-1" role="dialog">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <button class="close" aria-label="Close" (click)="cancelCommentModal()">\n              <span aria-hidden="true">&times;</span>\n            </button>\n            <h4 class="modal-title">确认操作</h4>\n          </div>\n          <div class="modal-body">\n            <div class="message">\n              <span class="icon text-warning">\n                <i class="ion-ios-information-outline"></i>\n              </span>\n              <span>确定要删除{{ del_comments ? \'这篇\' : \'选中\' }}评论吗？本操作不可逆</span>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button class="btn btn-primary confirm-btn" (click)="delComments()">确认删除</button>\n            <span>&nbsp;</span>\n            <button class="btn btn-default confirm-btn" (click)="cancelCommentModal()">取消</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n';
},1414:function(module,exports,__webpack_require__){"use strict";var router_1=__webpack_require__(40),comment_component_1=__webpack_require__(1259),list_1=__webpack_require__(1262),detail_1=__webpack_require__(1261),routes=[{path:"",component:comment_component_1.Comment,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:list_1.CommentList},{path:"post",redirectTo:"post/0",pathMatch:"full"},{path:"post/:post_id",component:list_1.CommentList},{path:"detail/:comment_id",component:detail_1.CommentDetail}]}];exports.routing=router_1.RouterModule.forChild(routes)},1415:function(module,exports,__webpack_require__){"use strict";var core_1=__webpack_require__(0),forms_1=__webpack_require__(12),router_1=__webpack_require__(40),comment_service_1=__webpack_require__(1236),comment_ua_1=__webpack_require__(1260),CommentDetail=function(){function CommentDetail(_fb,_route,_commentService){this._fb=_fb,this._route=_route,this._commentService=_commentService,this.UAParse=comment_ua_1.UAParse,this.OSParse=comment_ua_1.OSParse,this.comment_id=null,this.comments=null,this.article=null,this.comment={pid:"",post_id:"",state:"",is_top:"",likes:0,content:"",author:{name:"",email:"",site:""},extends:[]},this.editForm=_fb.group({pid:["0",forms_1.Validators.compose([forms_1.Validators.required])],state:["",forms_1.Validators.compose([forms_1.Validators.required])],is_top:["",forms_1.Validators.compose([forms_1.Validators.required])],likes:[0],content:["",forms_1.Validators.compose([forms_1.Validators.required])],user_name:["",forms_1.Validators.compose([forms_1.Validators.required])],user_email:["",forms_1.Validators.compose([forms_1.Validators.required])],user_site:[""],extends:[[]]}),this.pid=this.editForm.controls.pid,this.state=this.editForm.controls.state,this.is_top=this.editForm.controls.is_top,this.likes=this.editForm.controls.likes,this.content=this.editForm.controls.content,this.user_name=this.editForm.controls.user_name,this.user_email=this.editForm.controls.user_email,this.user_site=this.editForm.controls.user_site,this.extends=this.editForm.controls.extends}return CommentDetail.prototype.updateEditForm=function(){this.pid.setValue(this.comment.pid),this.state.setValue(this.comment.state),this.is_top.setValue(this.comment.is_top),this.likes.setValue(this.comment.likes),this.content.setValue(this.comment.content),this.user_name.setValue(this.comment.author.name),this.user_email.setValue(this.comment.author.email),this.user_site.setValue(this.comment.author.site),this.extends.setValue(this.comment.extends.filter(function(e){return!!e&&!!e.name&&e.value}))},CommentDetail.prototype.delExtendItem=function(index){this.extends.value.splice(index,1)},CommentDetail.prototype.addExtendItem=function(){this.extends.setValue(this.extends.value.concat([{}]))},CommentDetail.prototype.submitComment=function(comment){var _this=this;this.editForm.valid&&(Object.assign(this.comment,{pid:Number(comment.pid),likes:Number(comment.likes),state:Number(comment.state),is_top:Boolean(comment.is_top),author:{name:comment.user_name,email:comment.user_email},content:comment.content,extends:comment.extends.filter(function(e){return!!e&&!!e.name&&e.value})}),comment.user_site&&(this.comment.author.site=comment.user_site),this._commentService.updateCommentDetail(this.comment).then(function(comment){_this.comment=comment.result}).catch(function(error){}))},CommentDetail.prototype.getComments=function(params){var _this=this;this._commentService.getComments(params).then(function(comments){_this.comments=comments.result}).catch(function(error){})},CommentDetail.prototype.getCommentDetail=function(){var _this=this;this._commentService.getCommentDetail(this.comment_id).then(function(comment){_this.comment=comment.result,_this.updateEditForm(),Object.is(_this.comment.post_id,0)||_this.getCommentArticleDetail(),_this.getComments({post_id:_this.comment.post_id,per_page:1e3})}).catch(function(error){})},CommentDetail.prototype.getCommentArticleDetail=function(){var _this=this;this._commentService.getCommentArticleDetail(this.comment.post_id).then(function(article){_this.article=article.result}).catch(function(error){})},CommentDetail.prototype.ngOnInit=function(){var _this=this;this._route.params.subscribe(function(_a){var comment_id=_a.comment_id;comment_id&&(_this.comment_id=comment_id),_this.getCommentDetail()})},CommentDetail=__decorate([core_1.Component({selector:"comment-edit",encapsulation:core_1.ViewEncapsulation.None,styles:[__webpack_require__(1326)],template:__webpack_require__(1352)}),__metadata("design:paramtypes",["function"==typeof(_a="undefined"!=typeof forms_1.FormBuilder&&forms_1.FormBuilder)&&_a||Object,"function"==typeof(_b="undefined"!=typeof router_1.ActivatedRoute&&router_1.ActivatedRoute)&&_b||Object,"function"==typeof(_c="undefined"!=typeof comment_service_1.CommentService&&comment_service_1.CommentService)&&_c||Object])],CommentDetail);var _a,_b,_c}();exports.CommentDetail=CommentDetail},1416:function(module,exports,__webpack_require__){"use strict";var router_1=__webpack_require__(40),core_1=__webpack_require__(0),forms_1=__webpack_require__(12),ng2_bootstrap_1=__webpack_require__(299),comment_service_1=__webpack_require__(1236),comment_ua_1=__webpack_require__(1260),CommentList=function(){function CommentList(_fb,_route,_commentService){this._fb=_fb,this._route=_route,this._commentService=_commentService,this.UAParse=comment_ua_1.UAParse,this.OSParse=comment_ua_1.OSParse,this.getParams={sort:"-1",state:"all"},this.post_id=null,this.comments={data:[],pagination:{current_page:1,total_page:0,per_page:50,total:0}},this.commentsSelectAll=!1,this.selectedComments=[],this.selectedPostIds=[],this.searchForm=_fb.group({keyword:["",forms_1.Validators.compose([forms_1.Validators.required])]}),this.keyword=this.searchForm.controls.keyword}return CommentList.prototype.ngOnInit=function(){var _this=this;this._route.params.subscribe(function(_a){var post_id=_a.post_id;_this.post_id=post_id,_this.getComments()})},CommentList.prototype.batchSelectChange=function(is_select){var _this=this;this.comments.data.length&&(this.selectedComments=[],this.selectedPostIds=[],this.comments.data.forEach(function(item){item.selected=is_select,is_select&&_this.selectedComments.push(item._id),is_select&&_this.selectedPostIds.push(item.post_id)}))},CommentList.prototype.itemSelectChange=function(){var _this=this;this.selectedComments=[],this.selectedPostIds=[];var comments=this.comments.data;comments.forEach(function(item){item.selected&&_this.selectedComments.push(item._id),item.selected&&_this.selectedPostIds.push(item.post_id)}),this.selectedComments.length||(this.commentsSelectAll=!1),this.selectedComments.length&&this.selectedComments.length==comments.length&&(this.commentsSelectAll=!0)},CommentList.prototype.switchState=function(state){void 0==state||Object.is(state,this.getParams.state)||(this.getParams.state=state,this.getComments())},CommentList.prototype.searchComments=function(values){this.searchForm.valid&&this.getComments()},CommentList.prototype.resetGetParams=function(){this.searchForm.reset({keyword:""}),this.getParams.sort="-1"},CommentList.prototype.refreshComments=function(){this.getComments({page:this.comments.pagination.current_page})},CommentList.prototype.pageChanged=function(event){this.getComments({page:event.page})},CommentList.prototype.getComments=function(params){var _this=this;void 0===params&&(params={}),this.keyword.value&&(params.keyword=this.keyword.value),Object.keys(this.getParams).forEach(function(key){Object.is(_this.getParams[key],"all")||(params[key]=_this.getParams[key])}),params.page&&!Object.is(params.page,1)||(this.comments.pagination.current_page=1),this.post_id&&(params.post_id=this.post_id),this._commentService.getComments(params).then(function(comments){_this.comments=comments.result,_this.commentsSelectAll=!1,_this.selectedComments=[],_this.selectedPostIds=[]}).catch(function(error){})},CommentList.prototype.updateCommentState=function(comments,post_ids,state){var _this=this;this._commentService.updateCommentState(comments,post_ids,state).then(function(do_result){_this.getComments({page:_this.comments.pagination.current_page})}).catch(function(error){})},CommentList.prototype.delComments=function(){var _this=this,comments=this.del_comments||this.selectedComments,post_ids=[];if(Object.is(comments.length,1)){var currentComment=this.comments.data.find(function(c){return Object.is(comments[0],c._id)});currentComment&&(post_ids=[currentComment.post_id])}else post_ids=this.selectedPostIds;this._commentService.delComments(comments,post_ids).then(function(do_result){_this.delModal.hide(),_this.del_comments=null,_this.getComments({page:_this.comments.pagination.current_page})}).catch(function(error){_this.delModal.hide()})},CommentList.prototype.delCommentModal=function(comment){this.del_comments=comment,this.delModal.show()},CommentList.prototype.cancelCommentModal=function(){this.delModal.hide(),this.del_comments=null},__decorate([core_1.ViewChild("delModal"),__metadata("design:type","function"==typeof(_a="undefined"!=typeof ng2_bootstrap_1.ModalDirective&&ng2_bootstrap_1.ModalDirective)&&_a||Object)],CommentList.prototype,"delModal",void 0),CommentList=__decorate([core_1.Component({selector:"comment-list",encapsulation:core_1.ViewEncapsulation.None,template:__webpack_require__(1353),styles:[__webpack_require__(1327)]}),__metadata("design:paramtypes",["function"==typeof(_b="undefined"!=typeof forms_1.FormBuilder&&forms_1.FormBuilder)&&_b||Object,"function"==typeof(_c="undefined"!=typeof router_1.ActivatedRoute&&router_1.ActivatedRoute)&&_c||Object,"function"==typeof(_d="undefined"!=typeof comment_service_1.CommentService&&comment_service_1.CommentService)&&_d||Object])],CommentList);var _a,_b,_c,_d}();exports.CommentList=CommentList}});